<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="" />
  <meta name="author" content="and contributors" />
   <title>Ajustando um modelo SIR a uma epidemia de Influenza</title>  
  <link rel="shortcut icon" type="image/png" href="/modelagem_matematica/assets/images/favicon.png"/>
  <link rel="stylesheet" href="/modelagem_matematica/css/base.css"/>
  
  <script src="/modelagem_matematica/libs/mousetrap/mousetrap.min.js"></script>

  
    <link rel="stylesheet" href="/modelagem_matematica/libs/highlight/github.min.css">
    <script src="/modelagem_matematica/libs/highlight/highlight.pack.js"></script>
    <script src="/modelagem_matematica/libs/highlight/julia.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', (event) => {
        document.querySelectorAll('pre').forEach((el) => {
          hljs.highlightElement(el);
        });
      });
    </script>
  

  
    <link rel="stylesheet" href="/modelagem_matematica/libs/katex/katex.min.css">
  
</head>

<body>

  <div class="books-container">

  <aside class="books-menu">
  <input type="checkbox" id="menu">
  <label for="menu">☰</label>

  <div class="books-title">
    <a href="/modelagem_matematica/">Modelagem Matemática</a>
  </div>

  <br />

  <div class="books-subtitle">
    Notas de aula
  </div>

  <br />

  <div class="books-author">
    <a href="https://rmsrosa.github.io">Ricardo M. S. Rosa</a>
  </div>

  <div class="books-menu-content">
    <div class="menu-level-1">
    <li><a href="/modelagem_matematica/pages/intro">Introdução</a></li>
    </div>
    <div class="menu-level-1">
    <li>PARTE I</li>
    </div>
    <div class="menu-level-1">
    <li>1. Preliminares</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c01/0101-Aspectos_curso">1.1. Aspectos do curso</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c01/0102-Instalando_acessando_Julia">1.2. Instalando e acessando o Julia</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c01/0103-Primeiros_passos_Julia">1.3. Primeiros passos em Julia</a></li>
    </div>
    <div class="menu-level-1">
    <li>PARTE II</li>
    </div>
    <div class="menu-level-1">
    <li>2. Princípios de Modelagem Matemática</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c02/0201-Principios_basicos">2.1. Princípios básicos de modelagem</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c02/0202-Exemplos_tipos_modelagem">2.2. Exemplos de tipos de modelagem</a></li>
    </div>
    <div class="menu-level-1">
    <li>3. Análise Dimensional</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c03/0301-Quantidades_unidades_dimensoes">3.1. Quantidades, unidades e dimensões</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c03/0302-BuckinghamPi">3.2. Análise dimensional e o Teorema de Buckingham-Pi</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c03/0303-Unidades_Julia">3.3. Trabalhando com unidades e dimensões em Julia</a></li>
    </div>
    <div class="menu-level-1">
    <li>4. Ajuste de Parâmetros</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c04/0401-Minimos_quadrados_ajuste">4.1. Mínimos quadrados e o ajuste de parâmetros</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c04/0402-Exemplos_ajuste_linear">4.2. Exemplos de ajuste linear</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c04/0403-Modelos_redutiveis_linear_aplicacoes">4.3. Modelos redutíveis ao caso linear nos parâmetros e aplicações</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c04/0404-Minimos_quadrados_nao_linear">4.4. Mínimos quadrados não-linear</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c04/0405-Exemplos_ajuste_naolinear">4.5. Exemplos de ajuste não-linear de parâmetros</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c04/0406-Redes_neurais">4.6. Redes neurais</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c04/0407-Ajuste_em_redes_neurais">4.7. Ajuste de parâmetros em modelos de redes neurais</a></li>
    </div>
    <div class="menu-level-1">
    <li>5. Erros e Incertezas</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c05/0501-Erros_e_incertezas">5.1. Erros e incertezas</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c05/0502-Minimos_quadrados_verossimilhanca">5.2. Mínimos quadrados, maximização da verossimilhança e quantificação de incertezas em regressões lineares</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c05/0503-Propagacao_incertezas">5.3. Propagação de incertezas</a></li>
    </div>
    <div class="menu-level-1">
    <li>6. Avaliação de Modelos</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c06/0601-Qualidade_do_modelo">6.1. Qualidade do ajuste</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c06/0602-Validacao_do_modelo">6.2. Validação de modelos</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c06/0603-Comparacao_de_modelos">6.3. Comparação de modelos</a></li>
    </div>
    <div class="menu-level-1">
    <li>PARTE III</li>
    </div>
    <div class="menu-level-1">
    <li>7. Mecânica</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c07/0701-Mecanica_Newtoniana">7.1. Mecânica Newtoniana</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c07/0702-Mecanica_Lagrangiana">7.2. Mecânica Lagrangiana</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c07/0703-Conservacao_contexto_Newtoniano">7.3. Leis de conservação em um contexto Newtoniano</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c07/0704-Conservacao_contexto_Lagrangiano">7.4. Leis de conservação em um contexto Lagrangiano</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c07/0705-Hamiltonianos">7.5. Hamiltonianos</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c07/0706-Pendulo">7.6. Análise do período de um pêndulo planar simples</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c07/0707-Pendulo_angulos_grandes">7.7. Experimentos com pêndulos</a></li>
    </div>
    <div class="menu-level-1">
    <li>8. Modelos em Eletrônica</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c08/0801-Modelo_diodo">8.1. Modelagem da relação voltagem-corrente de um diodo</a></li>
    </div>
    <div class="menu-level-1">
    <li>9. Reações Químicas</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c09/0901-Lei_acao_de_massas">9.1. Lei de ação de massas</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c09/0902-Reacoes_enzimaticas">9.2. Modelagem de reações enzimática</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c09/0903-Isomerizacao">9.3. Lupulagem e a conversão de humulone em iso-humulone considerando saturação</a></li>
    </div>
    <div class="menu-level-1">
    <li>10. Modelos Epidemiológicos</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c10/1001-Modelos_epidemiologicos_compartimentais">10.1. Modelos epidemiológicos compartimentais</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c10/1002-Ajuste_SIR">10.2. Ajustando um modelo SIR a uma epidemia de Influenza</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c10/1003-Compartimentais_estruturados">10.3. Modelos compartimentais estruturados</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c10/1004-Individual_estocastico">10.4. Modelos individuais</a></li>
    </div>
    <div class="menu-level-1">
    <li>11. Séries de Fourier e Aplicações</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c11/1101-Series_Fourier">11.1. Séries de Fourier</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c11/1102-Transformada_discreta_Fourier">11.2. Transformada discreta de Fourier</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c11/1103-Ondas_sonoras_elementos_musicais">11.3. Ondas sonoras e elementos musicais</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/modelagem_matematica/pages/jupytered/c11/1104-Compressao_audio">11.4. Séries de Fourier e compressão de audio</a></li>
    </div>
<div>


  
    <a href="https://github.com/rmsrosa/modelagem_matematica/tree/modmat2022p1"><img src="/modelagem_matematica/assets/images/GitHub-Mark-32px.png" alt="GitHub repo" width="18" style="margin:5px 5px" align="left"></a>

  

</aside>


  <div class="books-content">

    
      <div class="navbar">
    <p id="nav">
<span id="nav-prev" style="float: left;">
<a class="menu-level-1" href="/modelagem_matematica/pages/jupytered/c10/1001-Modelos_epidemiologicos_compartimentais">10.1. Modelos epidemiológicos compartimentais <kbd>←</kbd></a>
</span>
<span id="nav-next" style="float: right;">
    <a class="menu-level-1" href="/modelagem_matematica/pages/jupytered/c10/1003-Compartimentais_estruturados"><kbd>→</kbd> 10.3. Modelos compartimentais estruturados</a>
</span>
    </p>
</div>
</br></br>

    

    
      <div class="badges">
<p>
<a href="https://nbviewer.org/urls/rmsrosa.github.io/modelagem_matematica/generated/jupytered/c10/1002-Ajuste_SIR.ipynb"><img align="left" src="https://img.shields.io/badge/view%20in-nbviewer-orange" alt="View in NBViewer" title="View Jupyter notebook in NBViewer"></a>
<a href="https://mybinder.org/v2/gh/rmsrosa/modelagem_matematica/julia-env-for-binder-2022p1?urlpath=git-pull%3Frepo%3Dhttps://github.com/rmsrosa/modelagem_matematica%26urlpath%3Dlab/tree%252Fmodelagem_matematica/generated/jupytered/c10/1002-Ajuste_SIR.ipynb%26branch%3Dgh-pages"><img align="left" src="https://mybinder.org/badge.svg" alt="Open in binder" title="Open in binder"></a>
<a href="/modelagem_matematica/generated/jupytered/c10/1002-Ajuste_SIR.ipynb"><img align="left" src="https://img.shields.io/badge/download-notebook-blue" alt="Download notebook" title="Download Jupyter notebook"></a>
<a href="/modelagem_matematica/src/jupyter/c10/1002-Ajuste_SIR.ipynb"><img align="left" src="https://img.shields.io/badge/view-source-lightblue" alt="View source" title="View source"></a>
</p>
</div></br>

    
<h1 id="get_title"><a href="#get_title" class="header-anchor">10.2. Ajustando um modelo SIR a uma epidemia de Influenza</a></h1>
<pre><code class="language-julia">using DifferentialEquations
using Random
using Distributions: Normal, MvNormal
using Statistics
using LsqFit
using Optim
using Plots
using Images</code></pre>
<ul>
<li><p>Vamos, agora, ajustar os parâmetros \(\beta\) e \(\gamma\) do modelo SIR aos dados de uma epidemia de Influenza em um escola de meninos &#40;internato&#41; no norte da Inglaterra.</p>
</li>
<li><p>Em um total de 763 residentes, em um período de duas semanas, o número de infectados a cada dia é dado pela lista</p>
</li>
</ul>
\[ \text{Infectados a partir do dia três} = [25, 75, 228, 297, 259, 235, 192, 126, 71, 28, 9, 7].
\]
<ul>
<li><p>Fonte: Brauer &amp; Castillo-Chavez &#40;2012&#41;.</p>
</li>
<li><p>Há uma lista um pouco diferente de infectados, que inclui desde, o dia da primeira ocorrência:</p>
</li>
</ul>
\[ \text{Infectados a partir do dia zero} = [1, 3, 7, 25, 72, 222, 282, 256, 233, 189, 123, 70, 25, 11, 4].
\]
<ul>
<li><p>Fonte: Ledder&#40;2013&#41;</p>
</li>
<li><p>Vamos usar, abaixo, os primeiros dados, de Brauer &amp; Castillo-Chavez &#40;2012&#41;.</p>
</li>
</ul>
<h2 id="ajuste"><a href="#ajuste" class="header-anchor">Ajuste</a></h2>
<ul>
<li><p>Nesse caso, o modelo nos dá, a partir dos dados iniciais e dos parâmetros, uma solução \((S(t), I(t), R(t))\).</p>
</li>
<li><p>Mas só temos dados dos números de infectados \(I_j\), a cada dia \(j=0, \ldots, 14\).</p>
</li>
<li><p>Assim, a nossa função objetivo só pode ser construída em cima de \(I(t)\) e dos dados \((t_j, I_j)\).</p>
</li>
<li><p>Em algumas situações, as próprias condições iniciais também podem entrar como parâmetros a serem ajustados, mas no caso mais controlado acima, vamos fixar as seguinte condições iniciais:</p>
<ul>
<li><p>\(I(0) = I_j = 1\) residente;</p>
</li>
<li><p>\(S(0) = 763 - 1 = 762\) residentes; e</p>
</li>
<li><p>\(R(0) = 0\) residentes.</p>
</li>
</ul>
</li>
<li><p>Definimos a taxa de evolução do sistema \((S,I)\) do modelo SIR:</p>
</li>
</ul>
<pre><code class="language-julia"># Data from Brauer &amp; Castillo-Chavez &#40;2012&#41;
N &#61; 763
dias_amostra &#61; &#91;3:14...&#93;
infectados_amostra &#61; &#91;25, 75, 228, 297, 259, 235, 192, 126, 71, 28, 9, 7&#93;

# Data from Ledder
#dias_amostra &#61; &#91;1:15...&#93;
#infectados_amostra &#61; &#91;1, 3, 7, 25, 72, 222, 282, 256, 233, 189, 123, 70, 25, 11, 4&#93;

nothing</code></pre>
<pre><code class="language-julia">plot&#40;dias_amostra, infectados_amostra, linestyle&#61;:dash&#41;
scatter&#33;&#40;dias_amostra, infectados_amostra, color&#61;1&#41;
plot&#33;&#40;xlabel&#61;&quot;dias&quot;, ylabel&#61;&quot;infectados&quot;,
    title&#61;&quot;Número de infectados a cada dia na escola no Reino Unido&quot;, titlefont&#61;10&#41;</code></pre>
<img src="/modelagem_matematica/assets/pages/jupytered/c10/1002-Ajuste_SIR/code/images/1002-Ajuste_SIR_3_1.png" alt="">
<h2 id="chute_inicial_dos_parâmetros"><a href="#chute_inicial_dos_parâmetros" class="header-anchor">Chute inicial dos parâmetros</a></h2>
<ul>
<li><p>Observe que a epidemia cresce e decresce rapidamente, sugerindo uma alta taxa de transmissão e um curto tempo de recuperação.</p>
</li>
<li><p>Por conta disso, vamos chutar, inicialmente, os seguintes valores dos parâmetros:</p>
<ul>
<li><p>\(\beta =  1.5\)</p>
</li>
<li><p>\(\gamma = 0.5\) &#40;dois dias de recuperação&#41;</p>
</li>
<li><p>\(\mathcal{R} = \beta/\gamma = 3.0\)</p>
</li>
</ul>
</li>
</ul>
<pre><code class="language-julia">ρ₀ &#61; &#91;1.5, 0.5&#93;
u₀ &#61; &#91;N-1, 1&#93;
tspan &#61; &#40;0.0, 14.0&#41;</code></pre>
<pre><code class="language-julia">&#40;0.0, 14.0&#41;</code></pre>
<pre><code class="language-julia">function dudt_SIR&#33;&#40;du, u, p, t&#41;
    β, γ &#61; p
    S, I &#61; u
    R &#61; N - S - I
    I_nov &#61; β * I * S / N # novos infectados
    du&#91;1&#93; &#61; - I_nov
    du&#91;2&#93; &#61; I_nov - γ * I
end</code></pre>
<pre><code class="language-julia">dudt_SIR&#33; &#40;generic function with 1 method&#41;</code></pre>
<pre><code class="language-julia">model&#40;t, ρ&#41; &#61; solve&#40;ODEProblem&#40;dudt_SIR&#33;, u₀, tspan, ρ&#41;, Tsit5&#40;&#41;&#41;&#40;t&#41;&#91;2&#93;</code></pre>
<pre><code class="language-julia">model &#40;generic function with 1 method&#41;</code></pre>
<pre><code class="language-julia">plot&#40;dias_amostra, infectados_amostra, linestyle&#61;:dash, label&#61;false&#41;
scatter&#33;&#40;dias_amostra, infectados_amostra, color&#61;1, label&#61;&quot;Dados&quot;&#41;
tempos &#61; 1.0:0.25:14.0
plot&#33;&#40;tempos, model.&#40;tempos, Ref&#40;ρ₀&#41;&#41;, label&#61;&quot;Modelo β&#61;&#36;&#40;ρ₀&#91;1&#93;&#41;, γ&#61;&#36;&#40;ρ₀&#91;2&#93;&#41;&quot;&#41;
plot&#33;&#40;xlabel&#61;&quot;dias&quot;, ylabel&#61;&quot;infectados&quot;, legend&#61;:topright,
    title&#61;&quot;Número de infectados a cada dia na escola no Reino Unido&quot;, titlefont&#61;10&#41;</code></pre>
<img src="/modelagem_matematica/assets/pages/jupytered/c10/1002-Ajuste_SIR/code/images/1002-Ajuste_SIR_7_1.png" alt="">
<h3 id="melhorando_o_chute_inicial"><a href="#melhorando_o_chute_inicial" class="header-anchor">Melhorando o chute inicial</a></h3>
<ul>
<li><p>Podemos ajustar um pouco mais aumentando a taxa de transmissão:</p>
<ul>
<li><p>\(\beta =  1.8\) &#40;taxa de contágio&#41;</p>
</li>
<li><p>\(\gamma = 0.5\) &#40;dois dias de recuperação&#41;</p>
</li>
<li><p>\(\mathcal{R} = \beta/\gamma = 3.6\)</p>
</li>
</ul>
</li>
</ul>
<pre><code class="language-julia">ρ₀ &#61; &#91;1.8, 0.5&#93;</code></pre>
<pre><code class="language-julia">2-element Vector&#123;Float64&#125;:
 1.8
 0.5</code></pre>
<pre><code class="language-julia">plot&#40;dias_amostra, infectados_amostra, linestyle&#61;:dash, label&#61;false&#41;
scatter&#33;&#40;dias_amostra, infectados_amostra, color&#61;1, label&#61;&quot;dados&quot;&#41;
tempos &#61; 1.0:0.25:14.0
plot&#33;&#40;tempos, model.&#40;tempos, Ref&#40;ρ₀&#41;&#41;, label&#61;&quot;Modelo β&#61;&#36;&#40;ρ₀&#91;1&#93;&#41;, γ&#61;&#36;&#40;ρ₀&#91;2&#93;&#41;&quot;&#41;
plot&#33;&#40;xlabel&#61;&quot;dias&quot;, ylabel&#61;&quot;infectados&quot;, legend&#61;:topright,
    title&#61;&quot;Número de infectados a cada dia na escola no Reino Unido&quot;, titlefont&#61;10&#41;</code></pre>
<img src="/modelagem_matematica/assets/pages/jupytered/c10/1002-Ajuste_SIR/code/images/1002-Ajuste_SIR_9_1.png" alt="">
<ul>
<li><p>Assim parece mais próximo, mas vamos fazer o ajuste usando <code>LsqFit</code>, com esse novo chute inicial.</p>
</li>
</ul>
<h2 id="ajuste_com_lsqfit"><a href="#ajuste_com_lsqfit" class="header-anchor">Ajuste com LsqFit</a></h2>
<pre><code class="language-julia">fit &#61; curve_fit&#40;&#40;t,ρ&#41; -&gt; model.&#40;t, Ref&#40;ρ&#41;&#41;, dias_amostra, infectados_amostra, ρ₀&#41;</code></pre>
<pre><code class="language-julia">LsqFit.LsqFitResult&#123;Vector&#123;Float64&#125;, Vector&#123;Float64&#125;, Matrix&#123;Float64&#125;, Vect
or&#123;Int64&#125;&#125;&#40;&#91;1.6682491395946721, 0.44168556986258944&#93;, &#91;11.300158076906051, 
26.713035784328596, -16.76828047337159, -9.563924212963059, 18.957607286142
775, -11.591611941519062, -27.387005722741605, -9.670669111835466, 9.454353
054971762, 26.983336226454668, 28.314904151597133, 18.215012626217053&#93;, &#91;10
0.56002432271706 -104.13885253850472; 313.99606007189016 -345.1498581600921
5; … ; -75.41290593639617 -143.58093947773298; -53.65106603063737 -111.8684
258497654&#93;, true, Int64&#91;&#93;&#41;</code></pre>
<pre><code class="language-julia">ρ &#61; fit.param</code></pre>
<pre><code class="language-julia">2-element Vector&#123;Float64&#125;:
 1.6682491395946721
 0.44168556986258944</code></pre>
<pre><code class="language-julia">plot&#40;dias_amostra, infectados_amostra, linestyle&#61;:dash, label&#61;false&#41;
scatter&#33;&#40;dias_amostra, infectados_amostra, color&#61;1, label&#61;&quot;Dados&quot;&#41;
tempos &#61; 1.0:0.25:14.0
plot&#33;&#40;tempos, model.&#40;tempos, Ref&#40;ρ&#41;&#41;, label&#61;&quot;Modelo ajustado&quot;&#41;
plot&#33;&#40;xlabel&#61;&quot;dias&quot;, ylabel&#61;&quot;infectados&quot;, legend&#61;:topright,
    title&#61;&quot;Número de infectados a cada dia na escola no Reino Unido&quot;, titlefont&#61;10&#41;</code></pre>
<img src="/modelagem_matematica/assets/pages/jupytered/c10/1002-Ajuste_SIR/code/images/1002-Ajuste_SIR_12_1.png" alt="">
<pre><code class="language-julia">covar &#61; estimate_covar&#40;fit&#41;</code></pre>
<pre><code class="language-julia">2×2 Matrix&#123;Float64&#125;:
 0.000861757  0.000194578
 0.000194578  0.000313972</code></pre>
<h2 id="outro_chute_inicial"><a href="#outro_chute_inicial" class="header-anchor">Outro chute inicial</a></h2>
<ul>
<li><p>A escolha de um bom chute inicial é importante, como podemos ver na tentativa de ajuste abaixo, com outro chute inicial.</p>
</li>
<li><p>Acabou achando os mesmos parâmetros, mas com mais dificuldade.</p>
</li>
<li><p>Em outros casos, pode nem funcionar.</p>
</li>
</ul>
<pre><code class="language-julia">curve_fit&#40;&#40;t,ρ&#41; -&gt; model.&#40;t, Ref&#40;ρ&#41;&#41;, dias_amostra, infectados_amostra, &#91;0.5, 0.2&#93;&#41;.param</code></pre>
<pre><code class="language-julia">2-element Vector&#123;Float64&#125;:
 1.6682492617500464
 0.4416855505070483</code></pre>
<h2 id="ajuste_com_o_optim"><a href="#ajuste_com_o_optim" class="header-anchor">Ajuste com o Optim</a></h2>
<ul>
<li><p>Também podemos usar o <code>Optim</code>.</p>
</li>
<li><p>Ele é mais flexível &#40;mais liberdade na escolha e na construção da função custo&#41;.</p>
</li>
<li><p>E costuma funcionar melhor.</p>
</li>
<li><p>Ele só não nos dá, automaticamente, a matrix de covariância.</p>
</li>
</ul>
<pre><code class="language-julia">custo&#40;ρ&#41; &#61; sum&#40;abs2, infectados_amostra - model.&#40;dias_amostra, Ref&#40;ρ&#41;&#41;&#41;</code></pre>
<pre><code class="language-julia">custo &#40;generic function with 1 method&#41;</code></pre>
<pre><code class="language-julia">ρ₀ &#61; &#91;1.5, 0.5&#93;
result &#61; optimize&#40;custo, ρ₀&#41;</code></pre>
<pre><code class="language-julia">* Status: success

 * Candidate solution
    Final objective value:     4.502256e&#43;03

 * Found with
    Algorithm:     Nelder-Mead

 * Convergence measures
    √&#40;Σ&#40;yᵢ-ȳ&#41;²&#41;/n ≤ 1.0e-08

 * Work counters
    Seconds run:   0  &#40;vs limit Inf&#41;
    Iterations:    68
    f&#40;x&#41; calls:    145</code></pre>
<pre><code class="language-julia">Optim.minimizer&#40;result&#41;</code></pre>
<pre><code class="language-julia">2-element Vector&#123;Float64&#125;:
 1.6682492852905042
 0.44168581226548664</code></pre>
<h2 id="propagação_de_incertezas"><a href="#propagação_de_incertezas" class="header-anchor">Propagação de incertezas</a></h2>
<ul>
<li><p>Usando a matrix de covariância obtida com o <code>LsqFit</code>.</p>
</li>
<li><p>E usando o método de Monte-Carlo.</p>
</li>
<li><p>Podemos calcular os intervalos de confiança ao longo do tempo.</p>
</li>
</ul>
<pre><code class="language-julia">num_amostras &#61; 200
parameters &#61; rand&#40;MersenneTwister&#40;21001&#41;, MvNormal&#40;ρ, covar&#41;, num_amostras&#41;</code></pre>
<pre><code class="language-julia">2×200 Matrix&#123;Float64&#125;:
 1.65479  1.64094   1.64311   1.64178   …  1.65732   1.6368    1.64749
 0.46985  0.435592  0.429651  0.403384     0.418683  0.469833  0.456223</code></pre>
<pre><code class="language-julia">scatter&#40;parameters&#91;1,:&#93;, parameters&#91;2,:&#93;&#41;</code></pre>
<img src="/modelagem_matematica/assets/pages/jupytered/c10/1002-Ajuste_SIR/code/images/1002-Ajuste_SIR_19_1.png" alt="">
<h3 id="incerteza"><a href="#incerteza" class="header-anchor">Incerteza</a></h3>
<pre><code class="language-julia">plot&#40;dias_amostra, infectados_amostra, linestyle&#61;:dash, label&#61;false&#41;
scatter&#33;&#40;dias_amostra, infectados_amostra, color&#61;1, label&#61;&quot;Dados&quot;&#41;
tempos &#61; 1.0:0.25:14.0
simulations &#61; fill&#40;0.0, length&#40;tempos&#41;, num_amostras&#41;
for n in 1:num_amostras
    ρ̃ &#61; parameters&#91;:,n&#93;
    simulations&#91;:,n&#93; &#61; model.&#40;tempos, Ref&#40;ρ̃&#41;&#41;
    plot&#33;&#40;tempos, simulations&#91;:,n&#93;, label&#61;false, alpha&#61;0.1, color&#61;2&#41;
end
plot&#33;&#40;tempos, mean&#40;simulations, dims&#61;2&#41;, color&#61;6, label&#61;&quot;média simulações&quot;&#41;
plot&#33;&#40;xlabel&#61;&quot;dias&quot;, ylabel&#61;&quot;infectados&quot;, legend&#61;:topright,
    title&#61;&quot;Número de infectados a cada dia na escola no Reino Unido&quot;, titlefont&#61;10&#41;</code></pre>
<img src="/modelagem_matematica/assets/pages/jupytered/c10/1002-Ajuste_SIR/code/images/1002-Ajuste_SIR_20_1.png" alt="">
<h2 id="exercícios"><a href="#exercícios" class="header-anchor">Exercícios</a></h2>
<ol>
<li><p>Considere o modelo SEIR e ajuste os seus parâmetros aos dados da escola do Reino Unido considerados no texto.</p>
</li>
<li><p>Idem para o modelo SIAR.</p>
</li>
<li><p>Idem para o modelo SEIAR.</p>
</li>
</ol>

    <div class="navbar">
    <p id="nav">
<span id="nav-prev" style="float: left;">
<a class="menu-level-1" href="/modelagem_matematica/pages/jupytered/c10/1001-Modelos_epidemiologicos_compartimentais">10.1. Modelos epidemiológicos compartimentais <kbd>←</kbd></a>
</span>
<span id="nav-next" style="float: right;">
    <a class="menu-level-1" href="/modelagem_matematica/pages/jupytered/c10/1003-Compartimentais_estruturados"><kbd>→</kbd> 10.3. Modelos compartimentais estruturados</a>
</span>
    </p>
</div>
</br></br>



<div class="page-foot">
    
        <div class="license">
            <a href=https://creativecommons.org/licenses/by-nc-nd/4.0/>(CC BY-NC-ND 4.0) Attribution-NonCommercial-NoDerivatives 4.0 International </a>
            
        </div>
    

    Last modified: July 12, 2022. Built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>.
</div><!-- CONTENT ENDS HERE -->

      </div> <!-- .books-content -->
    </div> <!-- .books-container -->

    
        <script src="/modelagem_matematica/libs/katex/katex.min.js"></script>
        <script src="/modelagem_matematica/libs/katex/auto-render.min.js"></script>
        <script>renderMathInElement(document.body)</script>
    

    
        <script src="/modelagem_matematica/libs/highlight/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>
    

  </body>
</html>
